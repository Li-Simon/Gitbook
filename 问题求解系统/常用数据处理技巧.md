# 常用数据处理技巧

## 文本数据

### 文本数据统计

统计文本中词出现的频率，具体一个场景就是统计购物历史记录中的每类物品总的销售量。这些技巧都要固化到自己软件系统中。

set\(\)是不重复集合，相当于字典的key。第一个函数得到字典的key。第二个函数建立一个list\(\),然后每一次购物记录作为一列。这次购物中有特定key则设为1，否则为0.

```py
def cross_selling(file_path_name):
    grocery_items = set()
    with open(file_path_name) as f:
        reader = csv.reader(f, delimiter=",")
        for i, line in enumerate(reader):
            grocery_items.update(line)
    output_list = list()
    with open(file_path_name) as f:
        reader = csv.reader(f, delimiter=",")
        for i, line in enumerate(reader):
            row_val = {item: 0 for item in grocery_items}//set item to 0 as initial value
            row_val.update({item: 1 for item in line})//set to 1 if item in line
            output_list.append(row_val)
    grocery_df = pd.DataFrame(output_list)
    return grocery_df


if __name__ == '__main__':
    file_path_name = "C:\Users\pili\GitBook\Kaggle\OnlineRetailTransactions\grocery_dataset.txt"
    cross_selling(file_path_name)
```

```py
item_summary_df = grocery_df.sum().sort_values(ascending=False).reset_index()
item_summary_df.rename(columns={item_summary_df.columns[0]:'item_name',item_summary_df.columns[1]:'item_count'},inplace=True)
```

降序排序，再更换columns的名字。

```py
import matplotlib.pyplot as plt
objects = (list(item_summary_df['item_name'].head(20)))
y_pos = np.arange(len(objects))
performance = list(item_summary_df['item_count'].head(20))
plt.bar(y_pos,performance,align='center',alpha=0.5)
plt.xticks(y_pos, objects, rotation='vertical')
plt.ylabel('Item count')
plt.title('Item sales distribution')
plt.show()
```

![](/assets/plot_xticks.png)

带多个标签数据的处理 1

```py
cf_pd.geoNetwork[0]
'{"continent": "Asia", "subContinent": "Western Asia", "country": "Turkey", "region": "Izmir", "metro": "(not set)", "city": "Izmir", "cityId": "not available in demo dataset", "networkDomain": "ttnet.com.tr", "latitude": "not available in demo dataset", "longitude": "not available in demo dataset", "networkLocation": "not available in demo dataset"}'
```

带多个标签数据的处理 2

```py
cf_pd.totals[0]
'{"visits": "1", "hits": "1", "pageviews": "1", "bounces": "1", "newVisits": "1"}'
```

#### 数据处理技巧

1. 把所有子标签都提取出来做为一个标签。一个标签就是一个feature  
   1. 怎么自动的提取子标签？
2. 列出所有的feature名字\(.columns\)    
3. 如果一个feature只有一个类，则舍去   
4. 对于时间这个特征，可以使用datetime把他分成年，月，日，星期，hour这多个特征来处理  
   1. 含有时间的feature怎么自动分割成小的特征？
5. 


时间特征处理

```py
from datetime import datetime
def date_process(df):
    df['date'] = pd.to_datetime(df["date"], format="%Y%m%d")
    df["_weekday"] = df['date'].dt.weekday
    df["_day"] = df['date'].dt.day
    df["_month"] = df['date'].dt.month
    df["_year"] = df['date'].dt.year
    df["_visitHour"] = (df['visitStartTime'].apply(lambda x:str(datetime.fromtimestamp(x).hour))).astype(int)
    return df
```

找到只有一个类的数据并删除

```
discovering_consts = [col for col in df_train.columns if df_train[col].nunique() == 1]
df_train.drop(discovering_consts, axis=1,inplace=True)
```



