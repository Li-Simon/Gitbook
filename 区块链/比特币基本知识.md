# 基本知识

# 地址

钱包由私钥与公钥（地址）组成，通过私钥可以得到公钥，这是由密码学保证的，类似于

$$Y = C^X%d$$ mod D  计算都是模掉一个大数D

其中C是已知的大的质数，X就是私钥，Y就是公钥，通过私钥X得到公钥Y很简单，但是通过公钥Y求解私钥X则很难

1：创建私钥

```
Key privateKey = new Key(); // generate a random private key
```

2：获得公钥

```
PubKey publicKey = privateKey.PubKey; //求得公钥
Console.WriteLine(publicKey); // 0251036303164f6c458e9f7abecb4e55e5ce9ec2b2f1d06d633c9653a07976560c
```

3：生成地址：miannet, testnet, regtest上的地址不同

RIPEMD160\(SHA256\(pubkey\)\)

```
Console.WriteLine(publicKey.GetAddress(Network.Main)); // 1PUYsjwfNmX64wS368ZR5FMouTtUmvtmTY
Console.WriteLine(publicKey.GetAddress(Network.TestNet)); // n3zWAo2eBnxLr3ueohXnuAa8mTVBhxmPhq
```

![](/assets/PubKeyHashToBitcoinAddress.png)

BTC的地址是对公钥做hash之后的结果。

A public key hash is generated by using a SHA256 hash on the public key, then a RIPEMD160 hash on the result, using Big

Endian notation. The function could look like this: RIPEMD160\(SHA256\(pubkey\)\)

# Bitcoin Secret\(WIF: Wallet Import Formator\)

私钥常表示成Base58Check的形式，称为Bitcoin Secret\(also known as Wallet Import Format or simply WIF\)

![](/assets/BitcoinSecret.png)

```csharp
Key privateKey = new Key(); // generate a random private key
BitcoinSecret mainNetPrivateKey = privateKey.GetBitcoinSecret(Network.Main); // generate our Bitcoin secret(also known as Wallet Import Format or
simply WIF) from our private key for the mainnet
BitcoinSecret testNetPrivateKey = privateKey.GetBitcoinSecret(Network.TestNet); // generate our Bitcoin secret(also known as Wallet Import Format
or simply WIF) from our private key for the testnet
Console.WriteLine(mainNetPrivateKey); // L5B67zvrndS5c71EjkrTJZ99UaoVbMUAK58GKdQUfYCpAa6jypvn
Console.WriteLine(testNetPrivateKey); // cVY5auviDh8LmYUW8AfafseD6p6uFoZrP7GjS3rzAerpRKE9Wmuz
bool WifIsBitcoinSecret = mainNetPrivateKey == privateKey.GetWif(Network.Main);
Console.WriteLine(WifIsBitcoinSecret); // True
```

从BitcoinSecret可以得到私钥privateKey,但是不可以从Bitcoin Address得到Public Key，因为Bitcoin Address是Public Key的Hash值。

```csharp
QBitNinjaClient client = new QBitNinjaClient(Network.Main);
var transactionID = uint256.Parse("f13dc48fb035bbf0a6e989a26b3ecb57b84f85e0836e777d6edf60d87a4a2d94");
QBitNinja.Client.Models.GetTransactionResponse transactionResponse = client.GetTransaction(transactionID).Result;

NBitcoin.Transaction transaction = transactionResponse.Transaction;
Console.WriteLine("transactionResponse: " + transactionResponse.TransactionId);
Console.WriteLine("transaction Hash: "+transaction.GetHash());
Console.WriteLine("Total out: " + transaction.TotalOut.ToString()); //交易总量

IEnumerable<IndexedTxIn> txIn = transaction.Inputs.AsIndexedInputs();
foreach(IndexedTxIn trx in txIn)
    Console.WriteLine("\n coin:"+ trx.ScriptSig.ToString());

IEnumerable<Coin> coins = transaction.Outputs.AsCoins();
foreach(Coin coin in coins)
{
    Console.WriteLine(coin.ToString());
    Console.WriteLine();
    var paymentScript = coin.TxOut.ScriptPubKey;
    Console.WriteLine("paymentScript: "+ paymentScript);//每笔输出都有签名，能解密这签名的人可以使用这笔BTC
}
```



