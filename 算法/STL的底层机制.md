# STL的底层机制

STL的底层机制都市以RB-Tree\(红黑树\)完成的。RB-tree也是一个独立容器，但并不给外界使用。红黑树这个名字的由来就是由于树的每个结点都被染上红色或者黑色，结点所着颜色被用来检测书的平衡性。在对结点插入和删除的操作中，肯恶搞会被旋转来保护树的平衡性。平均和最坏情况下的插入，删除，查找时间都是O\(log n\)。  
一个红黑树是一棵二叉查找树，除了二叉查找树带有的一般要求外，它还具有下列的属性：  
1. 结点为红色或者黑色。  
2. 所有叶子结点都是空结点，并且被着为黑色。  
3. 如果父节点是红色，则两个子节点都是黑色的。  
4. 节点到其子孙节点的每条路径上都包含相同数目的黑色节点。  
5. 根节点是黑色的。

map底层是以红黑树实现的。
#树
主要介绍二叉搜索树，AVL树和红黑树，以及介绍怎么通过旋转来为AVL树，红黑书删除和插入元素。  
## 二叉搜索树

二叉搜索树\(Binary Search Tree, BST\)主要用于查找，其好处则是把最差情况下的平均搜索时间降为O\(log n\)。它满足如下特征：  
左子树中的元素都小于等于根节点的数据，而右子树中的元素都大于等于根节点数据。  
二叉搜索树的基本操作有搜索，插入，删除。

### 索引二叉搜索树

索引二叉搜索树源于普通二叉搜索树，只是每个节点添加一个leftsize域，这个域的值就是该节点左子树的元素个数。

## 平衡搜索树

平衡二叉树结构有两种：AVL和红黑树。AVL和红黑树适合内部储存的应用，B-树适合外部储存的应用\(例如：存储在磁盘上的大型词典\)。这些平衡树结构都可以在最坏情况下用时O\(log n\)实现字典操作和按名次的操作。   
STL类map和multimap使用的是红黑树结构，以保证查找，插入和删除操作具有对数级的时间性能。[^1]
AVL树和红黑树都使用"旋转"来保持平衡。AVL树对每个插入操作最多需要一次旋转，对每个删除操作最多需要O(log n)次旋转。而红黑树对每个插入和删除操作，都只需要一次旋转。
###AVL树
如果数的高度总是O(log n)，我们就能保证查找，插入和删除的时间为O(log n)。
#####平衡树
最坏情况下的高度为O(log n)的树称为平衡树。  
AVL树的定义：  
一棵空的二叉树是AVL树；如果T是一棵非空二叉树，$$T_L$$和$$T_R$$分别是其左子树和右子树，那么当T满足以下条件时，T是一棵AVL树：  
1)：$$T_L$$和$$T_R$$是AVL树。  
2): $$|h_L-h_R| \le 1$$，其中$$h_L$$和$$h_R$$分别是$$T_L$$和$$T_R$$的高。  
一棵AVL搜索树既是二叉搜索树，也是AVL树。   

[^1]: 《数据结构，算法与应用--C++语言描述》P359

